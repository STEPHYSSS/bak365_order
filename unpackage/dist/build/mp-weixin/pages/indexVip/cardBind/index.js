(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/indexVip/cardBind/index"],{"2b8b":function(t,e,a){"use strict";(function(t){a("abfe");n(a("66fd"));var e=n(a("c337"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])},5055:function(t,e,a){},"8c5a":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("8732"));function i(t){return t&&t.__esModule?t:{default:t}}var o=function(){a.e("components_uni/uni-popup/uni-popup").then(function(){return resolve(a("d6a2"))}.bind(null,a)).catch(a.oe)},s=function(){a.e("components_uni/gpp-datePicker/gpp-datePicker").then(function(){return resolve(a("ee24"))}.bind(null,a)).catch(a.oe)},r=a("a2f1"),u=getApp(),d={components:{uniPopup:o,datePicker:s},data:function(){return{userPhone:"",showCard:!1,showCardApply:!1,result:"",list:[],hasPassword:!1,password:"",isOrder:!1,colorIndex:getApp().globalData.colorIndex,colorItem:getApp().globalData.itemColor,isCardType:null,form:{},currentBirthDay:"",listSex:[{label:"男",value:"1"},{label:"女",value:"2"}],disabledBtn:!1,objShowBtn:{WX_CardBind:"",WX_CardApply:""}}},onLoad:function(t){this.hasPassword=t.isPassword,this.isOrder=t.order||!1,this.isCardType=t.isCardType,this.currentBirthDay=r.formatTime(new Date,!0),this.isOrder&&this.getInfo()},onShow:function(){if(u.globalData.openID||this.$store.dispatch("Login"),"alipay"===u.globalData.provider){var t=my.getExtConfigSync();t&&t.mobile&&(this.userPhone=t.mobile)}},methods:{getInfo:function(){var t=this;this.$showLoads(0,""),n.default.api("CardBind.aspx").then((function(e){t.$showLoads(1,""),t.hasPassword=e.WX_CardPayNotPass,t.objShowBtn=e})).catch((function(t){}))},getPhoneClick:function(t){t&&(this.isCardType=t)},getPhoneNumber:function(e,a){var n=this,i="",o="",s="";if("alipay"===u.globalData.provider)s="Alipay/GetPhoneMobile.aspx",my.getPhoneNumber({success:function(t){i=t.response,n.getEncryptedData(s,"",i)},fail:function(e){t.showToast({title:"您已取消授权，无法获取手机号会导致无法使用微卡",icon:"none"})}});else{if(s="GetPhoneMobile.aspx",o=e.detail.iv,i=e.detail.encryptedData,!o||!i)return void t.showToast({title:"您已取消授权，无法获取手机号会导致无法申请微卡",icon:"none"});o=o.replace(/\+/g,"~"),i=i.replace(/\+/g,"~"),this.getEncryptedData(s,o,i)}},newPhoneNum:function(t){t&&(this.isCardType=t),"2"===this.isCardType?this.getCardList():this.getApplyCard()},getEncryptedData:function(t,e,a){var i=this;this.$showLoads(0,""),n.default.api(t,{IV:e||"",EncryptedData:a}).then((function(t){i.userPhone=t.Msg,i.$showLoads(1,""),"2"===i.isCardType?i.getCardList():i.getApplyCard()})).catch((function(t){}))},getApplyCard:function(){"1"===this.hasPassword?this.addAreaFun():this.showCardApply=!0},getCardList:function(){var t=this;n.default.api("Public/Submit_ajax.aspx",{Type:"GetCardList",Mobile:this.userPhone}).then((function(e){t.list=e.CardList,t.result=e.CardList[0].CardNo,t.showCard=!0,t.$showLoads(1,"")})).catch((function(t){}))},addAreaFun:function(){var e=this;if("1"===this.hasPassword||this.form.Pass){var a=this.form;a.Mobile=this.userPhone,a.BindSource="alipay"===u.globalData.provider?"2":"1",Object.assign(a,{Type:"CardApply"}),this.disabledBtn=!0,n.default.api("Public/Submit_ajax.aspx",a).then((function(a){t.showToast({title:a.Msg,icon:"none"}),setTimeout((function(){e.isOrder?t.navigateBack({delta:1}):t.switchTab({url:"/pages/indexVip/index"})}),1e3)})).catch((function(t){e.disabledBtn=!1}))}else t.showToast({title:"请输入卡密码",icon:"none"})},submitBtn:function(){var e=this;if(!this.disabledBtn)if("1"===this.hasPassword||this.password){var a="alipay"===u.globalData.provider?"2":"1";this.disabledBtn=!0,n.default.api("Public/Submit_ajax.aspx",{Type:"CardBind",Mobile:this.userPhone,CardNo:this.result,Pass:this.password,BindSource:a}).then((function(a){t.showToast({title:a.Msg,icon:"none"}),setTimeout((function(){e.isOrder?t.navigateBack({delta:1}):t.switchTab({url:"/pages/indexVip/index"})}),1e3)})).catch((function(t){e.disabledBtn=!1}))}else t.showToast({title:"请输入卡密码",icon:"none"})},onChange:function(t){this.result=t.detail.value},onChangePass:function(t){this.password=t.detail.value},onClone:function(t){t.show||(this.showCard=!1)},onConfirmDate:function(t){this.form.BirthDay=t.dateValue},clickSex:function(){}}};e.default=d}).call(this,a("543d")["default"])},a3f3:function(t,e,a){"use strict";var n,i=function(){var t=this,e=t.$createElement,n=(t._self._c,a("e024"));t.$mp.data=Object.assign({},{$root:{m0:n}})},o=[];a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){return n}))},c337:function(t,e,a){"use strict";a.r(e);var n=a("a3f3"),i=a("c87e");for(var o in i)"default"!==o&&function(t){a.d(e,t,(function(){return i[t]}))}(o);a("f248");var s,r=a("f0c5"),u=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,"19292d43",null,!1,n["a"],s);e["default"]=u.exports},c87e:function(t,e,a){"use strict";a.r(e);var n=a("8c5a"),i=a.n(n);for(var o in n)"default"!==o&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a},f248:function(t,e,a){"use strict";var n=a("5055"),i=a.n(n);i.a}},[["2b8b","common/runtime","common/vendor"]]]);