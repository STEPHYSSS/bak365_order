(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/indexVip/cardBind/index"],{"354c":function(t,e,n){"use strict";(function(t){n("b895");a(n("66fd"));var e=a(n("c550"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"5f89":function(t,e,n){"use strict";n.r(e);var a=n("d693"),i=n.n(a);for(var o in a)"default"!==o&&function(t){n.d(e,t,(function(){return a[t]}))}(o);e["default"]=i.a},aa30:function(t,e,n){"use strict";var a,i=function(){var t=this,e=t.$createElement,a=(t._self._c,n("8dd3"));t.$mp.data=Object.assign({},{$root:{m0:a}})},o=[];n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return a}))},c550:function(t,e,n){"use strict";n.r(e);var a=n("aa30"),i=n("5f89");for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n("d59c");var s,r=n("f0c5"),d=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,"19292d43",null,!1,a["a"],s);e["default"]=d.exports},d59c:function(t,e,n){"use strict";var a=n("e9e1"),i=n.n(a);i.a},d693:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(n("3955"));function i(t){return t&&t.__esModule?t:{default:t}}var o=function(){n.e("components_uni/uni-popup/uni-popup").then(function(){return resolve(n("117d"))}.bind(null,n)).catch(n.oe)},s=function(){n.e("components_uni/gpp-datePicker/gpp-datePicker").then(function(){return resolve(n("a55d"))}.bind(null,n)).catch(n.oe)},r=n("bf5e"),d=getApp(),u={components:{uniPopup:o,datePicker:s},data:function(){return{userPhone:"",showCard:!1,showCardApply:!1,result:"",list:[],hasPassword:!1,password:"",isOrder:!1,colorIndex:getApp().globalData.colorIndex,colorItem:getApp().globalData.itemColor,isCardType:null,form:{},currentBirthDay:"",listSex:[{label:"男",value:"1"},{label:"女",value:"2"}],disabledBtn:!1,objShowBtn:{WX_CardBind:"",WX_CardApply:""}}},onLoad:function(t){this.hasPassword=t.isPassword,this.isOrder=t.order||!1,this.isCardType=t.isCardType,this.currentBirthDay=r.formatTime(new Date,!0),this.isOrder&&this.getInfo()},onShow:function(){if(d.globalData.openID||this.$store.dispatch("Login"),"alipay"===d.globalData.provider){var t=my.getExtConfigSync();t&&t.mobile&&(this.userPhone=t.mobile)}},methods:{getInfo:function(){var t=this;this.$showLoads(0,""),a.default.api("CardBind.aspx").then((function(e){t.$showLoads(1,""),t.hasPassword=e.WX_CardPayNotPass,t.objShowBtn=e})).catch((function(t){}))},getPhoneClick:function(t){t&&(this.isCardType=t)},getPhoneNumber:function(e,n){var a=this,i="",o="",s="";if("alipay"===d.globalData.provider)s="Alipay/GetPhoneMobile.aspx",my.getPhoneNumber({success:function(t){i=t.response,a.getEncryptedData(s,"",i)},fail:function(e){t.showToast({title:"您已取消授权，无法获取手机号会导致无法使用微卡",icon:"none"})}});else{if(s="GetPhoneMobile.aspx",o=e.detail.iv,i=e.detail.encryptedData,!o||!i)return void t.showToast({title:"您已取消授权，无法获取手机号会导致无法申请微卡",icon:"none"});o=o.replace(/\+/g,"~"),i=i.replace(/\+/g,"~"),this.getEncryptedData(s,o,i)}},newPhoneNum:function(t){t&&(this.isCardType=t),"2"===this.isCardType?this.getCardList():this.getApplyCard()},getEncryptedData:function(t,e,n){var i=this;this.$showLoads(0,""),a.default.api(t,{IV:e||"",EncryptedData:n}).then((function(t){i.userPhone=t.Msg,i.$showLoads(1,""),"2"===i.isCardType?i.getCardList():i.getApplyCard()})).catch((function(t){}))},getApplyCard:function(){"1"===this.hasPassword?this.addAreaFun():this.showCardApply=!0},getCardList:function(){var t=this;a.default.api("Public/Submit_ajax.aspx",{Type:"GetCardList",Mobile:this.userPhone}).then((function(e){t.list=e.CardList,t.result=e.CardList[0].CardNo,t.showCard=!0,t.$showLoads(1,"")})).catch((function(t){}))},addAreaFun:function(){var e=this;if("1"===this.hasPassword||this.form.Pass){var n=this.form;n.Mobile=this.userPhone,n.BindSource="alipay"===d.globalData.provider?"2":"1",Object.assign(n,{Type:"CardApply"}),this.disabledBtn=!0,a.default.api("Public/Submit_ajax.aspx",n).then((function(n){t.showToast({title:n.Msg,icon:"none"}),setTimeout((function(){e.isOrder?t.navigateBack({delta:1}):t.switchTab({url:"/pages/indexVip/index"})}),1e3)})).catch((function(t){e.disabledBtn=!1}))}else t.showToast({title:"请输入卡密码",icon:"none"})},submitBtn:function(){var e=this;if(!this.disabledBtn)if("1"===this.hasPassword||this.password){var n="alipay"===d.globalData.provider?"2":"1";this.disabledBtn=!0,a.default.api("Public/Submit_ajax.aspx",{Type:"CardBind",Mobile:this.userPhone,CardNo:this.result,Pass:this.password,BindSource:n}).then((function(n){t.showToast({title:n.Msg,icon:"none"}),setTimeout((function(){e.isOrder?t.navigateBack({delta:1}):t.switchTab({url:"/pages/indexVip/index"})}),1e3)})).catch((function(t){e.disabledBtn=!1}))}else t.showToast({title:"请输入卡密码",icon:"none"})},onChange:function(t){this.result=t.detail.value},onChangePass:function(t){this.password=t.detail.value},onClone:function(t){t.show||(this.showCard=!1)},onConfirmDate:function(t){this.form.BirthDay=t.dateValue},clickSex:function(){}}};e.default=u}).call(this,n("543d")["default"])},e9e1:function(t,e,n){}},[["354c","common/runtime","common/vendor"]]]);